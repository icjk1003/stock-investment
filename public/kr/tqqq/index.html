<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TQQQ 가이드 (KR) | 나스닥100 3배 레버리지 백테스트 · 미래 시뮬레이터</title>
  <meta name="description" content="TQQQ(나스닥100 3배 레버리지 ETF) 가이드. KR 기준(세금/환율 반영)으로 백테스트/미래 시뮬을 확인하세요." />

  <link rel="canonical" href="https://myvaluepick.com/kr/tqqq/" />
  <link rel="alternate" hreflang="ko" href="https://myvaluepick.com/kr/tqqq/" />
  <link rel="alternate" hreflang="en" href="https://myvaluepick.com/us/tqqq/" />
  <link rel="alternate" hreflang="x-default" href="https://myvaluepick.com/kr/tqqq/" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
    body { font-family: 'Pretendard', sans-serif; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900">
  <!-- Top Nav (텍스트 100% 동일) -->
  <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/kr/" class="flex items-center gap-2">
      <div class="w-9 h-9 rounded-xl bg-amber-500"></div>
      <div class="font-extrabold text-lg">MyValuePick</div>
      <span class="text-xs font-bold text-amber-700 bg-amber-50 px-2 py-1 rounded-lg">KR</span>
    </a>
    <div class="flex items-center gap-2">
      <a href="/kr/" class="text-sm font-bold text-slate-500 hover:text-amber-600 transition">홈</a>
      <a href="/backtest/?region=kr&ticker=TQQQ" class="text-sm font-bold text-slate-500 hover:text-amber-600 transition">백테스트</a>
      <a href="/future/?region=kr&ticker=TQQQ" class="text-sm font-bold text-slate-500 hover:text-amber-600 transition">미래시뮬</a>
      <a href="/us/tqqq/" class="text-sm font-extrabold text-amber-700 bg-amber-50 px-3 py-2 rounded-xl hover:bg-amber-100 transition">EN</a>
    </div>
  </div>

  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 pb-6">
    <div class="bg-white border border-slate-100 rounded-3xl shadow-sm p-6 md:p-10">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div>
          <div class="inline-flex items-center gap-2 text-xs font-black text-amber-700 bg-amber-50 px-3 py-1 rounded-full">
            레버리지 (고위험)
          </div>
          <h1 class="mt-3 text-3xl md:text-4xl font-black text-amber-700">TQQQ 가이드 (KR)</h1>
          <p class="mt-3 text-slate-600 leading-relaxed">
            TQQQ는 나스닥100의 <b>3배 레버리지</b>를 목표로 하는 ETF예요.
            상승장에서는 빠르게 올라갈 수 있지만, 하락장에서는 손실이 매우 커질 수 있어요.
          </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
          <a href="/backtest/?region=kr&ticker=TQQQ"
             class="text-center px-5 py-3 rounded-2xl bg-amber-500 text-white font-extrabold hover:bg-amber-600 transition">
            TQQQ 백테스트 →
          </a>
          <a href="/future/?region=kr&ticker=TQQQ"
             class="text-center px-5 py-3 rounded-2xl bg-slate-900 text-white font-extrabold hover:bg-black transition">
            TQQQ 미래시뮬 →
          </a>
        </div>
      </div>

      <!-- ✅ Price Widget -->
      <div class="mt-8 bg-white border border-slate-100 rounded-3xl p-6 md:p-8 shadow-sm">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div>
            <h2 class="text-xl md:text-2xl font-black">TQQQ 주가</h2>
            <p class="mt-1 text-sm text-slate-500">
              데이터: 서버(Firebase Functions) · 티커: <b>TQQQ</b>
            </p>
          </div>

          <div class="flex items-center gap-2 flex-wrap">
            <div class="inline-flex rounded-2xl bg-slate-100 p-1">
              <button id="btnUSD"
                class="px-3 py-2 rounded-xl font-extrabold text-sm text-slate-700 hover:bg-slate-200"
                onclick="setDisplayCurrency('USD')">USD</button>
              <button id="btnLOCAL"
                class="px-3 py-2 rounded-xl font-extrabold text-sm bg-white shadow-sm"
                onclick="setDisplayCurrency('LOCAL')">KRW</button>
            </div>

            <button class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 font-extrabold text-sm"
              onclick="loadPrice('1M')">1M</button>
            <button class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 font-extrabold text-sm"
              onclick="loadPrice('6M')">6M</button>
            <button class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 font-extrabold text-sm"
              onclick="loadPrice('1Y')">1Y</button>
            <button class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 font-extrabold text-sm"
              onclick="loadPrice('5Y')">5Y</button>
          </div>
        </div>

        <div class="mt-5 grid md:grid-cols-4 gap-4">
          <div class="rounded-2xl bg-slate-900 text-white p-5 shadow-lg">
            <div id="priceLabel" class="text-xs text-slate-300 font-bold uppercase">현재가(KRW)</div>
            <div id="etfPrice" class="mt-2 text-2xl font-black">-</div>
            <div id="etfPriceDate" class="mt-1 text-xs text-slate-300">-</div>
            <div id="etfFxLine" class="mt-1 text-xs text-slate-300">-</div>
          </div>

          <div class="rounded-2xl bg-amber-50 border border-amber-100 p-5">
            <div class="text-xs text-amber-700 font-bold uppercase">기간 수익률</div>
            <div id="etfReturn" class="mt-2 text-2xl font-black text-amber-800">-</div>
            <div id="etfRange" class="mt-1 text-xs text-amber-800/70">-</div>
          </div>

          <div class="md:col-span-2 rounded-2xl bg-white border border-slate-200 p-4">
            <div class="text-xs font-bold text-slate-500 mb-2">가격 추이</div>
            <div style="position: relative; height: 220px; width: 100%;">
              <canvas id="etfChart"></canvas>
            </div>
            <div id="etfStatus" class="mt-2 text-xs text-slate-400">-</div>
          </div>
        </div>
      </div>

      <!-- ✅ 핵심 요약 -->
      <div class="mt-8 grid md:grid-cols-4 gap-4">
        <div class="rounded-2xl bg-white border border-slate-100 p-5">
          <div class="text-xs font-black text-slate-500 uppercase">핵심</div>
          <div class="mt-2 font-extrabold text-lg">나스닥100 3배</div>
          <p class="mt-2 text-sm text-slate-600">단기 변동성에 매우 민감</p>
        </div>
        <div class="rounded-2xl bg-white border border-slate-100 p-5">
          <div class="text-xs font-black text-slate-500 uppercase">성격</div>
          <div class="mt-2 font-extrabold text-lg">공격적</div>
          <p class="mt-2 text-sm text-slate-600">상승장에서 수익 극대화 가능</p>
        </div>
        <div class="rounded-2xl bg-white border border-slate-100 p-5">
          <div class="text-xs font-black text-slate-500 uppercase">리스크</div>
          <div class="mt-2 font-extrabold text-lg">손실 확대</div>
          <p class="mt-2 text-sm text-slate-600">하락장에서 회복이 매우 어려울 수 있음</p>
        </div>
        <div class="rounded-2xl bg-white border border-slate-100 p-5">
          <div class="text-xs font-black text-slate-500 uppercase">KR 포인트</div>
          <div class="mt-2 font-extrabold text-lg">환율 영향</div>
          <p class="mt-2 text-sm text-slate-600">USD↔KRW 변동이 성과에 영향</p>
        </div>
      </div>

      <!-- ✅ 이런 사람에게 / 주의할 점 (QQQ와 동일 블록) -->
      <div class="mt-8 grid md:grid-cols-2 gap-4">
        <div class="rounded-3xl bg-emerald-50 border border-emerald-100 p-6">
          <h3 class="text-lg font-black text-emerald-800">👍 이런 사람에게 잘 맞아요</h3>
          <ul class="mt-3 space-y-2 text-sm text-emerald-900/80 list-disc pl-5">
            <li>높은 변동성을 감수하고 공격적으로 수익을 노리는 경우</li>
            <li>비중을 작게(위성자산) 두고 리밸런싱/손절 기준이 있는 경우</li>
            <li>하락장 대응(현금 비중, 분할매수/규칙)이 명확한 경우</li>
          </ul>
        </div>
        <div class="rounded-3xl bg-rose-50 border border-rose-100 p-6">
          <h3 class="text-lg font-black text-rose-800">⚠️ 주의할 점</h3>
          <ul class="mt-3 space-y-2 text-sm text-rose-900/80 list-disc pl-5">
            <li>장기 하락/횡보 구간에서 손실이 크게 누적될 수 있음</li>
            <li>장기 하락/횡보 구간에서 손실이 크게 누적될 수 있음</li>
            <li>“올인 장투”보단 비중 관리가 핵심 + 환율 영향도 추가</li>
          </ul>
        </div>
      </div>

      <!-- ✅ FAQ (텍스트 100% 동일) -->
      <div class="mt-8 rounded-3xl bg-white border border-slate-100 p-6 md:p-8">
        <h3 class="text-xl font-black">FAQ</h3>
        <p class="mt-1 text-sm text-slate-500">자주 묻는 질문을 모았어요. (접기/펼치기)</p>

        <div class="mt-4 space-y-3">
          <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <summary class="font-extrabold cursor-pointer">이 ETF는 배당투자용인가요?</summary>
            <p class="mt-2 text-sm text-slate-600 leading-relaxed">
              ETF마다 성격이 달라요. 어떤 상품은 <b>배당</b>이 강점이고, 어떤 상품은 <b>성장(가격)</b>이 강점이에요.
              중요한 건 “배당만”이 아니라 <b>총수익(가격+배당)</b> 관점으로 함께 보는 겁니다.
            </p>
          </details>

          <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <summary class="font-extrabold cursor-pointer">다른 대표 ETF(S&P500/나스닥100)랑 뭐가 달라요?</summary>
            <p class="mt-2 text-sm text-slate-600 leading-relaxed">
              어떤 ETF는 시장 전체에 가깝게 <b>분산</b>되어 있고, 어떤 ETF는 특정 섹터/스타일(성장/배당/레버리지)에 <b>집중</b>돼요.
              그래서 기대수익/변동성이 달라질 수 있어요.
            </p>
          </details>

          <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <summary class="font-extrabold cursor-pointer">KRW로 보면 왜 USD와 결과가 달라지죠?</summary>
            <p class="mt-2 text-sm text-slate-600 leading-relaxed">
              한국 투자자는 결과가 <b>주가(USD) + 환율(USDKRW)</b> 조합으로 결정돼요.
              그래서 동일한 주가 흐름이라도 환율이 오르내리면 KRW 기준 수익이 달라질 수 있어요.
            </p>
          </details>

          <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <summary class="font-extrabold cursor-pointer">백테스트/미래시뮬은 무엇을 기준으로 계산하나요?</summary>
            <p class="mt-2 text-sm text-slate-600 leading-relaxed">
              백테스트는 과거 가격/배당(가능한 범위)을 이용해 적립식 매수/DRIP 등을 반영해요.
              미래 시뮬은 사용자가 입력한 가정(상승률/세율/적립액 등) 기반의 산술 시뮬레이션입니다.
            </p>
          </details>
        </div>
      </div>

      <!-- ✅ 면책 / 데이터 -->
      <div class="mt-8 rounded-3xl bg-amber-50 border border-amber-100 p-6 md:p-8">
        <h3 class="text-lg font-black text-amber-800">⚠️ 면책 (Disclaimer)</h3>
        <p class="mt-2 text-sm text-amber-900/80 leading-relaxed">
          본 페이지의 정보와 계산 결과는 참고용이며, 미래 수익을 보장하지 않습니다.
          투자 판단과 책임은 사용자 본인에게 있습니다.
        </p>
        <div class="mt-4 text-xs text-amber-900/70 leading-relaxed">
          <b>데이터 안내</b> · 가격/배당/환율은 외부 데이터 제공처를 기반으로 서버(Firebase Functions)에서 조회됩니다.
          데이터 지연/누락/오차가 있을 수 있습니다.
        </div>
      </div>

      <!-- ✅ 다른 티커 가이드 (텍스트 100% 동일) -->
      <div class="mt-8 rounded-3xl bg-white border border-slate-100 p-6 md:p-8">
        <div class="flex items-center justify-between flex-wrap gap-3">
          <div>
            <h3 class="text-xl font-black">다른 티커 가이드</h3>
            <p class="mt-1 text-sm text-slate-500">비교하면 더 빨리 감이 잡혀요.</p>
          </div>
          <div class="text-sm text-slate-500 font-bold">KR 기준</div>
        </div>

        <div class="mt-5 grid md:grid-cols-3 gap-4">
          <a href="/kr/schd/" class="rounded-2xl border border-slate-200 hover:border-amber-300 bg-slate-50 p-5 transition">
            <div class="text-xs font-black text-slate-500 uppercase">Dividend</div>
            <div class="mt-2 text-lg font-extrabold">SCHD</div>
            <p class="mt-2 text-sm text-slate-600">배당 성장 중심 ETF 가이드</p>
          </a>
          <a href="/kr/spy/" class="rounded-2xl border border-slate-200 hover:border-amber-300 bg-slate-50 p-5 transition">
            <div class="text-xs font-black text-slate-500 uppercase">Core</div>
            <div class="mt-2 text-lg font-extrabold">SPY</div>
            <p class="mt-2 text-sm text-slate-600">S&P500 대표 ETF 가이드</p>
          </a>
          <a href="/kr/tqqq/" class="rounded-2xl border border-slate-200 hover:border-amber-300 bg-slate-50 p-5 transition">
            <div class="text-xs font-black text-slate-500 uppercase">Leveraged</div>
            <div class="mt-2 text-lg font-extrabold">TQQQ</div>
            <p class="mt-2 text-sm text-slate-600">레버리지(고위험) 가이드</p>
          </a>
        </div>
      </div>

    </div>
  </section>

  <!-- Footer (텍스트 100% 동일) -->
  <footer class="max-w-6xl mx-auto px-4 py-10 text-center text-xs text-slate-400">
    © 2026 MyValuePick · Contact: icjk1003@gmail.com
  </footer>

  <script>
    /* SPY 파일과 동일 로직, TICKER만 TQQQ */
    const TICKER = "TQQQ";
    const REGION = { code:"kr", localCcy:"KRW", localLocale:"ko-KR", fxPairLabel:"USDKRW", showFx:true };

    let chart;
    let displayCurrencyMode = "LOCAL";
    let cachedRange = "1Y";
    let cachedPrices = [];
    let fxMap = new Map();
    let fxDatesSorted = [];
    let fxOk = false;

    function ymd(d){ return new Date(d).toISOString().slice(0,10); }
    function addDays(dateStr, days){
      const d = new Date(dateStr + "T00:00:00Z");
      d.setUTCDate(d.getUTCDate() + days);
      return d.toISOString().slice(0,10);
    }
    function calcStartByRange(endStr, range){
      if(range==="1M") return addDays(endStr,-40);
      if(range==="6M") return addDays(endStr,-220);
      if(range==="1Y") return addDays(endStr,-400);
      if(range==="5Y") return addDays(endStr,-2000);
      return addDays(endStr,-400);
    }
    async function fetchHistory(ticker,start,end){
      const url = `/api/schdHistory?ticker=${encodeURIComponent(ticker)}&start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`;
      const r = await fetch(url);
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }
    async function fetchFX(start,end){
      const url = `/api/fxHistory?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`;
      const r = await fetch(url);
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }
    function normalizeDateKey(d){ return d ? String(d).slice(0,10) : null; }
    function pickFxValue(p){
      const v = p?.close ?? p?.rate ?? p?.value ?? p?.fx ?? p?.price ?? p?.adjClose ?? p?.adj_close;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }
    function buildFXMap(fxPrices){
      const map = new Map();
      for(const p of fxPrices||[]){
        const k = normalizeDateKey(p?.date);
        const n = pickFxValue(p);
        if(k && n && n>0) map.set(k,n);
      }
      return map;
    }
    function getFXSmart(dateStr){
      if(!fxOk) return null;
      if(fxMap.has(dateStr)) return fxMap.get(dateStr);

      const next = addDays(dateStr,+1);
      if(fxMap.has(next)) return fxMap.get(next);

      for(let k=1;k<=7;k++){
        const prev = addDays(dateStr,-k);
        if(fxMap.has(prev)) return fxMap.get(prev);
      }

      let lo=0,hi=fxDatesSorted.length-1,ans=-1;
      while(lo<=hi){
        const mid=(lo+hi)>>1;
        if(fxDatesSorted[mid] <= dateStr){ ans=mid; lo=mid+1; }
        else hi=mid-1;
      }
      if(ans>=0) return fxMap.get(fxDatesSorted[ans]);
      return fxMap.get(fxDatesSorted[0]) || null;
    }
    function fmtUSD(v){
      if(!Number.isFinite(v)) return "-";
      return "$"+v.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});
    }
    function fmtLOCAL(v){
      if(!Number.isFinite(v)) return "-";
      const opts = (REGION.localCcy==="KRW") ? {maximumFractionDigits:0} : {minimumFractionDigits:2,maximumFractionDigits:2};
      const symbol = (REGION.localCcy==="KRW") ? "₩" : "";
      return symbol + v.toLocaleString(REGION.localLocale, opts);
    }
    function fmtPct(v){
      if(!Number.isFinite(v)) return "-";
      const sign = v>0 ? "+" : "";
      return sign + (v*100).toFixed(2) + "%";
    }
    function fmtFxLine(fx,dateStr){
      if(!Number.isFinite(fx)||fx<=0) return "-";
      const fxFmt = (REGION.localCcy==="KRW") ? Math.round(fx).toLocaleString("ko-KR")
        : fx.toLocaleString(REGION.localLocale,{minimumFractionDigits:4,maximumFractionDigits:4});
      return `적용 환율: 1 USD = ${fxFmt} ${REGION.localCcy} (${dateStr})`;
    }
    function updateToggleUI(){
      const btnUSD=document.getElementById("btnUSD");
      const btnLOCAL=document.getElementById("btnLOCAL");

      if(!REGION.showFx || REGION.localCcy==="USD"){
        btnLOCAL.style.display="none";
        btnUSD.className="px-3 py-2 rounded-xl font-extrabold text-sm bg-white shadow-sm";
        document.getElementById("priceLabel").innerText="현재가(USD)";
        return;
      }

      btnLOCAL.style.display="";
      btnLOCAL.innerText=REGION.localCcy;

      if(displayCurrencyMode==="USD"){
        btnUSD.className="px-3 py-2 rounded-xl font-extrabold text-sm bg-white shadow-sm";
        btnLOCAL.className="px-3 py-2 rounded-xl font-extrabold text-sm text-slate-700 hover:bg-slate-200";
      }else{
        btnLOCAL.className="px-3 py-2 rounded-xl font-extrabold text-sm bg-white shadow-sm";
        btnUSD.className="px-3 py-2 rounded-xl font-extrabold text-sm text-slate-700 hover:bg-slate-200";
      }

      document.getElementById("priceLabel").innerText =
        (displayCurrencyMode==="USD") ? "현재가(USD)" : `현재가(${REGION.localCcy})`;
    }
    function setDisplayCurrency(mode){
      if(mode==="LOCAL" && (!REGION.showFx || REGION.localCcy==="USD")) return;
      if(mode==="LOCAL" && !fxOk){
        alert("환율 데이터가 아직 준비되지 않았어요. fxHistory Functions를 먼저 정상화해야 합니다.");
        return;
      }
      displayCurrencyMode=mode;
      updateToggleUI();
      if(cachedPrices.length>0) renderFromCache();
    }
    function drawChart(labels,values,yPrefix){
      const ctx=document.getElementById("etfChart").getContext("2d");
      if(chart) chart.destroy();
      chart=new Chart(ctx,{
        type:"line",
        data:{ labels, datasets:[{label:TICKER,data:values,pointRadius:0,borderWidth:2,fill:false}] },
        options:{
          responsive:true, maintainAspectRatio:false,
          plugins:{ legend:{ display:false } },
          scales:{ x:{ ticks:{ maxTicksLimit:6 } }, y:{ ticks:{ callback:v=>yPrefix+v } } }
        }
      });
    }
    function renderFromCache(){
      const status=document.getElementById("etfStatus");
      const priceEl=document.getElementById("etfPrice");
      const dateEl=document.getElementById("etfPriceDate");
      const fxLineEl=document.getElementById("etfFxLine");
      const retEl=document.getElementById("etfReturn");
      const rangeEl=document.getElementById("etfRange");

      const prices=cachedPrices;
      if(prices.length<5) return;

      const first=prices[0];
      const last=prices[prices.length-1];

      rangeEl.innerText=`${first.date} ~ ${last.date} (${cachedRange})`;
      dateEl.innerText="기준일: "+last.date;

      const maxPoints=260;
      let use=prices;
      if(prices.length>maxPoints){
        const step=Math.ceil(prices.length/maxPoints);
        use=prices.filter((_,i)=>i%step===0);
        if(use[use.length-1].date!==last.date) use.push(last);
      }

      const firstUSD=Number(first.close);
      const lastUSD=Number(last.close);

      if(displayCurrencyMode==="USD" || !REGION.showFx || REGION.localCcy==="USD"){
        const rUSD=(lastUSD/firstUSD)-1;
        retEl.innerText=fmtPct(rUSD);
        priceEl.innerText=fmtUSD(lastUSD);
        drawChart(use.map(p=>p.date), use.map(p=>Number(p.close)), "$");
        status.innerText="완료 (USD)";
        fxLineEl.innerText="-";
        return;
      }

      const firstFx=getFXSmart(first.date);
      const lastFx=getFXSmart(last.date);
      if(!firstFx || !lastFx){
        status.innerText=`환율 부족: ${(!firstFx?first.date:last.date)} (fxHistory 확인 필요)`;
        fxLineEl.innerText="-";
        retEl.innerText="-";
        return;
      }

      const firstLocal=firstUSD*firstFx;
      const lastLocal=lastUSD*lastFx;
      const rLOCAL=(lastLocal/firstLocal)-1;

      retEl.innerText=fmtPct(rLOCAL);
      fxLineEl.innerText=fmtFxLine(lastFx,last.date);
      priceEl.innerText=fmtLOCAL(lastLocal);

      const localLabels=[];
      const localValues=[];
      for(const p of use){
        const fx=getFXSmart(p.date);
        if(!fx) continue;
        localLabels.push(p.date);
        localValues.push(Number(p.close)*fx);
      }

      const yPrefix=(REGION.localCcy==="KRW") ? "₩" : "";
      drawChart(localLabels, localValues, yPrefix);
      status.innerText=`완료 (${REGION.localCcy}, ${REGION.fxPairLabel} 적용)`;
    }
    async function loadPrice(range="1Y"){
      const status=document.getElementById("etfStatus");
      const priceEl=document.getElementById("etfPrice");
      const dateEl=document.getElementById("etfPriceDate");
      const fxLineEl=document.getElementById("etfFxLine");
      const retEl=document.getElementById("etfReturn");
      const rangeEl=document.getElementById("etfRange");

      try{
        cachedRange=range;
        status.innerText="불러오는 중...";
        priceEl.innerText="-";
        dateEl.innerText="-";
        fxLineEl.innerText="-";
        retEl.innerText="-";
        rangeEl.innerText="-";

        const end=ymd(new Date());
        const start=calcStartByRange(end,range);

        const data=await fetchHistory(TICKER,start,end);
        const prices=(data.prices||[])
          .filter(p=>p?.date && Number.isFinite(Number(p.close)))
          .map(p=>({ date:String(p.date).slice(0,10), close:Number(p.close) }));

        if(prices.length<5){
          status.innerText="가격 데이터가 충분하지 않아요.";
          return;
        }
        cachedPrices=prices;

        fxOk=false;
        fxMap=new Map();
        fxDatesSorted=[];

        if(REGION.showFx && REGION.localCcy!=="USD"){
          try{
            const fxStart=addDays(start,-30);
            const fxData=await fetchFX(fxStart,end);

            const raw=(fxData.prices||fxData.rates||fxData.data||[]);
            const parsed=[];
            for(const x of raw){
              const k=normalizeDateKey(x?.date);
              if(!k) continue;
              const n=pickFxValue(x);
              if(n && n>0) parsed.push({ date:k, close:n });
            }

            fxMap=buildFXMap(parsed);
            fxDatesSorted=Array.from(fxMap.keys()).sort();
            fxOk=fxDatesSorted.length>0;
          }catch(e){ fxOk=false; }
        }

        if(displayCurrencyMode==="LOCAL" && !fxOk) displayCurrencyMode="USD";
        updateToggleUI();
        renderFromCache();

        if(REGION.showFx && REGION.localCcy!=="USD" && !fxOk){
          status.innerText="완료 (USD). KRW 변환은 fxHistory가 필요합니다.";
        }
      }catch(e){
        document.getElementById("etfStatus").innerText="오류: "+String(e).slice(0,180);
      }
    }

    updateToggleUI();
    loadPrice("1Y");
  </script>
</body>
</html>
