<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; }
        .month-row { display: none; }
        .month-row.active { display: table-row; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-700">SCHD í†µí•© ìì‚° ì‹œë®¬ë ˆì´í„° ğŸ“ˆ</h1>
            <p class="text-gray-600 mt-2">ì´ í‰ê°€ ìì‚° = íˆ¬ìì›ê¸ˆ + ì‹œì„¸ì°¨ìµ + ë°°ë‹¹ìˆ˜ìµ</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 space-y-4">
                    <h2 class="text-xl font-semibold border-b pb-2">íˆ¬ì ì„¤ì •</h2>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">ì´ˆê¸° íˆ¬ìê¸ˆ (ì›)</label>
                        <input type="number" id="initial" value="50000000" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">ì›” ì ë¦½ê¸ˆ (ì›)</label>
                        <input type="number" id="monthly" value="2000000" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">ì—° ë°°ë‹¹ ìˆ˜ìµë¥  (%)</label>
                        <input type="number" id="yield" value="3.4" step="0.1" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">ì—° ë°°ë‹¹ ì„±ì¥ë¥  (%)</label>
                        <input type="number" id="divGrowth" value="11" step="0.1" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">ì—° ì£¼ê°€ ìƒìŠ¹ë¥  (%)</label>
                        <input type="number" id="priceGrowth" value="5" step="0.1" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <!-- âœ… ì¶”ê°€: ë¯¸êµ­ ì›ì²œì§•ìˆ˜ ë°°ë‹¹ì„¸ -->
                    <div>
                        <label class="block text-xs font-medium text-gray-500">ë¯¸êµ­ ì›ì²œì§•ìˆ˜ ë°°ë‹¹ì„¸ìœ¨ (%)</label>
                        <input type="number" id="withholdingTax" value="15" step="0.1" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                        <p class="text-[11px] text-gray-400 mt-1">ë°°ë‹¹ ê³„ì‚° ì‹œ (1 - ì„¸ìœ¨)ë¡œ ì„¸í›„ ë°°ë‹¹ì„ ì¬íˆ¬ìí•©ë‹ˆë‹¤.</p>
                    </div>

                    <div>
                        <label class="block text-xs font-medium text-gray-500">íˆ¬ì ê¸°ê°„ (ë…„)</label>
                        <input type="number" id="years" value="15" class="w-full mt-1 p-2 border rounded-md outline-blue-500">
                    </div>

                    <button onclick="runSimulation()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition">
                        ê³„ì‚°í•˜ê¸°
                    </button>
                </div>
            </div>

            <div class="lg:col-span-3 space-y-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h3 class="text-lg font-bold mb-4 text-gray-700 text-center">ìì‚° êµ¬ì„± ìš”ì†Œë³„ ëˆ„ì  ì„±ì¥ ì¶”ì´</h3>
                    <div style="position: relative; height:450px; width:100%">
                        <canvas id="unifiedChart"></canvas>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-slate-900 p-5 rounded-2xl text-white shadow-lg">
                        <p class="text-slate-400 text-xs">ìµœì¢… ì´ í‰ê°€ ìì‚°</p>
                        <p id="resTotal" class="text-xl font-bold mt-1">-</p>
                    </div>
                    <div class="bg-emerald-600 p-5 rounded-2xl text-white shadow-lg">
                        <p class="text-emerald-100 text-xs">ëˆ„ì  ìˆ˜ìµ (ì°¨ìµ+ë°°ë‹¹)</p>
                        <p id="resProfit" class="text-xl font-bold mt-1">-</p>
                    </div>
                    <div class="bg-amber-500 p-5 rounded-2xl text-white shadow-lg">
                        <p class="text-amber-50 text-xs">ë§ˆì§€ë§‰ í•´ ì›” ë°°ë‹¹(ì„¸í›„)</p>
                        <p id="resMonthlyDiv" class="text-xl font-bold mt-1">-</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-8 bg-white p-6 rounded-2xl shadow-sm border border-gray-100 overflow-x-auto">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2 text-gray-800">ì—°ë„ë³„ ë°ì´í„° (í–‰ í´ë¦­ ì‹œ ìƒì„¸ í¼ì¹¨)</h2>
            <table class="w-full text-left text-sm border-collapse">
                <thead>
                    <tr class="bg-gray-100 text-gray-600 border-b text-xs uppercase">
                        <th class="p-3">ì—°ì°¨/ì›”</th>
                        <th class="p-3">ëˆ„ì  ì›ê¸ˆ</th>
                        <th class="p-3 text-emerald-600">ëˆ„ì  ì‹œì„¸ì°¨ìµ</th>
                        <th class="p-3 text-amber-600">ëˆ„ì  ë°°ë‹¹ìˆ˜ìµ</th>
                        <th class="p-3 font-bold text-slate-900">ì´ í‰ê°€ìì‚°</th>
                        <th class="p-3">ì›” ë°°ë‹¹ê¸ˆ(ì„¸í›„)</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let unifiedChart;

        function runSimulation() {
            const initial = parseFloat(document.getElementById('initial').value);
            const monthly = parseFloat(document.getElementById('monthly').value);
            const yieldRate = parseFloat(document.getElementById('yield').value) / 100;
            const divGrowth = parseFloat(document.getElementById('divGrowth').value) / 100;
            const priceGrowth = parseFloat(document.getElementById('priceGrowth').value) / 100;
            const years = parseInt(document.getElementById('years').value, 10);

            // âœ… ë¯¸êµ­ ì›ì²œì§•ìˆ˜ ë°°ë‹¹ì„¸ìœ¨(ê¸°ë³¸ 15%)
            const withholdingTax = parseFloat(document.getElementById('withholdingTax').value) / 100;

            let currentBalance = initial;
            let totalPrincipal = initial;
            let totalCapitalGain = 0;
            let totalDividendProfit = 0;
            let currentYield = yieldRate;

            const labels = ['ì‹œì‘'];
            const pData = [initial]; // ëˆ„ì  ì›ê¸ˆ
            const gData = [0];       // ëˆ„ì  ì‹œì„¸ì°¨ìµ
            const dData = [0];       // ëˆ„ì  ë°°ë‹¹ìˆ˜ìµ
            const tData = [initial]; // ì´ í‰ê°€ìì‚°

            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            for (let year = 1; year <= years; year++) {
                let yearlyDivTotal = 0;
                let monthHtml = '';

                for (let month = 1; month <= 12; month++) {
                    // 1) ì›ê¸ˆ ì ë¦½
                    totalPrincipal += monthly;
                    currentBalance += monthly;

                    // 2) ì‹œì„¸ ì°¨ìµ(ë³µë¦¬)
                    const mPriceGain = currentBalance * (priceGrowth / 12);
                    totalCapitalGain += mPriceGain;
                    currentBalance += mPriceGain;

                    // 3) ë°°ë‹¹ ìˆ˜ìµ(ì„¸í›„) + ì¬íˆ¬ì
                    const mDivGross = currentBalance * (currentYield / 12);
                    const mDivNet = mDivGross * (1 - withholdingTax);

                    yearlyDivTotal += mDivNet;
                    totalDividendProfit += mDivNet;
                    currentBalance += mDivNet;

                    monthHtml += `<tr class="month-row year-${year} bg-gray-50 border-b text-gray-400 text-xs">
                        <td class="p-2 pl-8 font-medium text-blue-400">ã„´ ${month}ì›”</td>
                        <td class="p-2">${Math.round(totalPrincipal).toLocaleString()}ì›</td>
                        <td class="p-2">${Math.round(totalCapitalGain).toLocaleString()}ì›</td>
                        <td class="p-2">${Math.round(totalDividendProfit).toLocaleString()}ì›</td>
                        <td class="p-2 font-bold text-slate-500">${Math.round(currentBalance).toLocaleString()}ì›</td>
                        <td class="p-2 text-amber-500">${Math.round(mDivNet).toLocaleString()}ì›</td>
                    </tr>`;
                }

                // ë‹¤ìŒ í•´ ë°°ë‹¹ë¥ (=Yield) ì„±ì¥
                currentYield *= (1 + divGrowth);

                labels.push(year + 'ë…„');
                pData.push(totalPrincipal);
                gData.push(totalCapitalGain);
                dData.push(totalDividendProfit);
                tData.push(currentBalance);

                const yearRow = `<tr class="year-header border-b hover:bg-blue-50 cursor-pointer transition" onclick="toggleMonths(${year})">
                    <td class="p-3 font-bold text-blue-700">â–¶ ${year}ë…„ì°¨</td>
                    <td class="p-3">${Math.round(totalPrincipal).toLocaleString()}ì›</td>
                    <td class="p-3 text-emerald-600 font-semibold">${Math.round(totalCapitalGain).toLocaleString()}ì›</td>
                    <td class="p-3 text-amber-600 font-semibold">${Math.round(totalDividendProfit).toLocaleString()}ì›</td>
                    <td class="p-3 font-black text-slate-900 bg-slate-50">${Math.round(currentBalance).toLocaleString()}ì›</td>
                    <td class="p-3 font-bold text-gray-700">${Math.round(yearlyDivTotal / 12).toLocaleString()}ì›</td>
                </tr>`;

                tableBody.innerHTML += yearRow + monthHtml;

                if (year === years) {
                    document.getElementById('resTotal').innerText = Math.round(currentBalance).toLocaleString() + 'ì›';
                    document.getElementById('resProfit').innerText = Math.round(totalCapitalGain + totalDividendProfit).toLocaleString() + 'ì›';
                    document.getElementById('resMonthlyDiv').innerText = Math.round(yearlyDivTotal / 12).toLocaleString() + 'ì›';
                }
            }

            updateChart(labels, pData, gData, dData, tData);
        }

        function toggleMonths(year) {
            const rows = document.querySelectorAll(`.year-${year}`);
            rows.forEach(row => row.classList.toggle('active'));
        }

        // âœ… ì›ê¸ˆ(ì•„ë˜) â†’ ì°¨ìµ â†’ ë°°ë‹¹(ìœ„) ìŠ¤íƒ + ì´í‰ê°€ìì‚°(ê²€ì • ì„ ) + ê·¸ë˜í”„ ì†Œìˆ˜ì  ì œê±°
        function updateChart(labels, principal, gain, dividend, total) {
            const ctx = document.getElementById('unifiedChart').getContext('2d');
            if (unifiedChart) unifiedChart.destroy();

            unifiedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'ëˆ„ì  ì›ê¸ˆ',
                            data: principal,
                            stack: 'components',
                            backgroundColor: 'rgba(37, 99, 235, 0.7)',
                            borderColor: '#1d4ed8',
                            borderWidth: 1,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            order: 1
                        },
                        {
                            label: 'ëˆ„ì  ì‹œì„¸ì°¨ìµ',
                            data: gain,
                            stack: 'components',
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#059669',
                            borderWidth: 1,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            order: 2
                        },
                        {
                            label: 'ëˆ„ì  ë°°ë‹¹ìˆ˜ìµ',
                            data: dividend,
                            stack: 'components',
                            backgroundColor: 'rgba(245, 158, 11, 0.7)',
                            borderColor: '#d97706',
                            borderWidth: 1,
                            fill: true,
                            tension: 0.1,
                            pointRadius: 0,
                            order: 3
                        },
                        {
                            label: 'ì´ í‰ê°€ìì‚°',
                            data: total,
                            stack: 'totalLine', // ìŠ¤íƒ ë¶„ë¦¬(ì¤‘ìš”)
                            borderColor: '#000000',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 0,
                            order: 99
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            // âœ… ê·¸ë˜í”„ í‘œì‹œ ì†Œìˆ˜ì  ì œê±° (ì–µ ë‹¨ìœ„ ì •ìˆ˜)
                            ticks: { callback: (val) => Math.round(val / 100000000) + 'ì–µ' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: (ctx) => {
                                    const v = Math.round(ctx.parsed.y);
                                    return `${ctx.dataset.label}: ${v.toLocaleString()}ì›`;
                                },
                                footer: (tooltipItems) => {
                                    const totalItem = tooltipItems.find(i => i.dataset.label === 'ì´ í‰ê°€ìì‚°');
                                    if (totalItem) {
                                        return 'ì´ í‰ê°€ìì‚°: ' + Math.round(totalItem.parsed.y).toLocaleString() + 'ì›';
                                    }
                                    let sum = 0;
                                    tooltipItems.forEach(i => sum += i.parsed.y);
                                    return 'ì´ í‰ê°€ìì‚°: ' + Math.round(sum).toLocaleString() + 'ì›';
                                }
                            }
                        },
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        runSimulation();
    </script>
</body>
</html>
